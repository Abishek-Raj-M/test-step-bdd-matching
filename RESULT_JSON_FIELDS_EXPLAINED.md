# Result JSON Fields: Complete Reference

This document explains all the information available in the result JSON files generated by the matching pipeline.

---

## üìä Top-Level Summary Fields

These fields provide overall statistics for the entire run:

```json
{
  "total_testcases": 97,           // Total number of test cases processed
  "total_steps": 1130,              // Total number of test steps processed
  "total_reused": 1101,             // Steps marked as REUSED_TEMPLATE
  "total_new_required": 29,         // Steps marked as NEW_BDD_REQUIRED
  "testcases": [...]                // Array of individual test case results
}
```

**Use Cases:**
- Overall match rate: `total_reused / total_steps * 100`
- Success metrics for the entire dataset
- Quick overview of system performance

---

## üß™ Test Case Level Fields

Each test case contains:

```json
{
  "testcase_id": "C60092679",       // Unique test case identifier
  "total_steps": 28,                 // Number of steps in this test case
  "reused_count": 28,                // Steps reused in this test case
  "new_required_count": 0,          // Steps requiring new BDD in this test case
  "results": [...]                   // Array of individual step results
}
```

**Use Cases:**
- Per-test-case match rate analysis
- Identify test cases with low match rates
- Track which test cases need more BDD coverage

---

## üîç Individual Step Result Fields

Each step result (`results[]` array item) contains comprehensive matching information:

### 1. **Query Identification**

```json
{
  "query_id": "C60092679_chunk_0",           // Unique identifier: {testcase_id}_chunk_{index}
  "parent_testcase_id": "C60092679",         // Parent test case ID
  "chunk_index": 0,                          // Step index within test case (0-based)
  "original_chunk": "1. Scan the prepared...", // Original test step text (as written)
  "full_testcase_text": "1. Scan the prepared...\n2. Confirm...", // Complete test case text
  "normalized_text": "scan the prepared lotto bet and ENTER the stake of <amount> in the highlighted box"
}
```

**Use Cases:**
- Track which step from which test case
- Compare original vs normalized text
- Understand full context of the test case

---

### 2. **Normalization Information**

```json
{
  "normalized_text": "scan the prepared lotto bet and ENTER the stake of <amount> in the highlighted box"
}
```

**What it shows:**
- Text after normalization (lowercase, placeholder replacement, etc.)
- Domain terms preserved (e.g., "ENTER", "F12")
- Action verbs canonicalized
- Placeholders extracted (e.g., `<amount>`)

**Use Cases:**
- Debug normalization issues
- Understand how text was processed
- Compare normalization across different steps

---

### 3. **Top-K Candidates (1-to-Many Matches)**

```json
{
  "top_k_candidates": [
    {
      "individual_step_id": 13279,           // Unique BDD step ID
      "step_type": "Then",                    // BDD step type: "Given", "When", or "Then"
      "step_text": "I set stake '200' for the bet", // Actual BDD step text
      "step_index": 3,                        // Position of step within scenario (0-based)
      "scenario_id": 724,                     // Parent scenario ID
      "scenario_name": "OTC- Ante Post Option", // Scenario name
      "scenario_full_text": "Scenario: OTC- Ante Post Option\nGiven...", // Full scenario text
      "scenario_given_steps": "Given I am logged into...", // All Given steps
      "scenario_when_steps": null,            // All When steps (or null)
      "scenario_then_steps": "Then I set stake...", // All Then steps
      "reranker_score": null,                 // Reranker score (null if reranker skipped)
      "vector_similarity": 0.7113746404647827 // Vector similarity score (0-1)
    },
    // ... up to 5 candidates total
  ]
}
```

**Key Information:**

#### Individual Step Details:
- **`individual_step_id`**: Unique identifier for this BDD step
- **`step_type`**: BDD step type (Given/When/Then)
- **`step_text`**: The actual BDD step text
- **`step_index`**: Position within the scenario

#### Scenario Context:
- **`scenario_id`**: Links steps to their parent scenario
- **`scenario_name`**: Human-readable scenario name
- **`scenario_full_text`**: Complete scenario with all steps
- **`scenario_given_steps`**: All Given steps grouped together
- **`scenario_when_steps`**: All When steps grouped together (or null)
- **`scenario_then_steps`**: All Then steps grouped together

#### Scores:
- **`reranker_score`**: Cross-encoder reranker score (can be negative, typically -2.0 to +2.0)
  - `null` if reranker was skipped
  - Higher is better
  - Used for final ranking when reranker is called
- **`vector_similarity`**: Vector embedding similarity (0.0 to 1.0)
  - Always present
  - Higher is better
  - Used for initial retrieval

**Use Cases:**
- **1-to-Many Matching**: See all potential matches (up to 5)
- **Scenario Grouping**: Identify which steps belong to same scenario (`scenario_id`)
- **Step Ordering**: Understand step sequence within scenario (`step_index`)
- **Score Analysis**: Compare vector vs reranker scores
- **Context Understanding**: See full scenario context for each match

---

### 4. **Selected Match Information**

```json
{
  "selected_candidate_id": 13279,            // ID of the top-ranked match
  "selected_template": "Then: I set stake '200' for the bet" // Display format: {step_type}: {step_text}
}
```

**Use Cases:**
- Identify which match was chosen as the best
- Display format for UI/reports
- Track which BDD steps are most frequently reused

---

### 5. **Final Decision**

```json
{
  "final_action": "REUSED_TEMPLATE"  // or "NEW_BDD_REQUIRED"
}
```

**Values:**
- **`REUSED_TEMPLATE`**: At least one match met the threshold
  - Reranker threshold: `reranker_score >= min_score_threshold` (default: 0.0)
  - Vector threshold: `vector_similarity >= 0.65` (when reranker skipped)
- **`NEW_BDD_REQUIRED`**: No matches met the threshold
  - Indicates a new BDD step needs to be created

**Use Cases:**
- Determine if step can be reused or needs new BDD
- Calculate match rate
- Identify gaps in BDD coverage

---

### 6. **Score Information**

```json
{
  "reranker_score": null,                    // Top match reranker score (null if skipped)
  "vector_similarity": 0.7113746404647827    // Top match vector similarity
}
```

**Notes:**
- These are the scores for the **top-ranked match** (selected candidate)
- `reranker_score` is `null` when reranker was skipped
- `vector_similarity` is always present
- Compare with `top_k_candidates[].reranker_score` and `top_k_candidates[].vector_similarity` for all matches

**Use Cases:**
- Analyze confidence in matches
- Identify borderline cases (scores near threshold)
- Compare performance when reranker is used vs skipped

---

### 7. **Performance Metrics**

```json
{
  "processing_time_ms": 56.63728713989258   // Time taken to process this step (milliseconds)
}
```

**Use Cases:**
- Performance analysis
- Identify slow queries
- Optimize pipeline bottlenecks
- Calculate average processing time

---

### 8. **Processing Notes**

```json
{
  "notes": "All top 5 above 90th percentile (0.711)"  // Processing notes/decisions
}
```

**Common Values:**
- **Reranker Skipped Reasons:**
  - `"All top 5 above 90th percentile (0.711)"` - Condition 2 triggered
  - `"Cluster separation: 0.125 (top mean=0.854, rest mean=0.729)"` - Condition 3 triggered
  - `"Top score dominant (top=0.920‚â•0.880, all top 5‚â•0.800)"` - Condition 4 triggered
  - `"Percentile gap: 15.0 points (5th=80.0th, 6th=65.0th)"` - Condition 5 triggered
  - `"Only 3 candidates (‚â§5), skipping reranker"` - Condition 1 triggered
- **Reranker Used:**
  - `""` (empty string) - Reranker was used
- **Errors:**
  - `"Error: {error_message}"` - Processing error occurred

**Use Cases:**
- Understand why reranker was skipped/used
- Debug dynamic reranking decisions
- Analyze skip reason distribution
- Identify processing errors

---

## üìã Complete Field Reference Table

| Field | Type | Description | When Null/Empty |
|-------|------|-------------|-----------------|
| **Top Level** |
| `total_testcases` | int | Total test cases processed | Never |
| `total_steps` | int | Total steps processed | Never |
| `total_reused` | int | Steps marked REUSED_TEMPLATE | Never |
| `total_new_required` | int | Steps marked NEW_BDD_REQUIRED | Never |
| **Test Case Level** |
| `testcase_id` | string | Unique test case ID | Never |
| `total_steps` | int | Steps in this test case | Never |
| `reused_count` | int | REUSED steps in this test case | Never |
| `new_required_count` | int | NEW_BDD_REQUIRED steps | Never |
| **Step Result Level** |
| `query_id` | string | Unique query identifier | Never |
| `parent_testcase_id` | string | Parent test case ID | Never |
| `chunk_index` | int | Step index (0-based) | Never |
| `original_chunk` | string | Original test step text | Never |
| `full_testcase_text` | string | Complete test case text | Never |
| `normalized_text` | string | Normalized text | Never (empty on error) |
| `top_k_candidates` | array | Up to 5 match candidates | Never (empty array if no matches) |
| `selected_candidate_id` | int\|null | Top match ID | null if no matches |
| `selected_template` | string | Display format | Empty if no matches |
| `final_action` | string | REUSED_TEMPLATE or NEW_BDD_REQUIRED | Never |
| `reranker_score` | float\|null | Top match reranker score | null if reranker skipped |
| `vector_similarity` | float\|null | Top match vector similarity | null if no matches |
| `processing_time_ms` | float | Processing time (ms) | Never |
| `notes` | string | Processing notes/decisions | Empty string if none |
| **Candidate Level** |
| `individual_step_id` | int | Unique BDD step ID | Never |
| `step_type` | string | Given/When/Then | Never |
| `step_text` | string | BDD step text | Never |
| `step_index` | int | Position in scenario | Never |
| `scenario_id` | int | Parent scenario ID | Never |
| `scenario_name` | string | Scenario name | Never |
| `scenario_full_text` | string | Full scenario text | Never |
| `scenario_given_steps` | string\|null | All Given steps | null if none |
| `scenario_when_steps` | string\|null | All When steps | null if none |
| `scenario_then_steps` | string\|null | All Then steps | null if none |
| `reranker_score` | float\|null | Reranker score | null if reranker skipped |
| `vector_similarity` | float | Vector similarity | Never |

---

## üéØ Common Analysis Use Cases

### 1. **Calculate Match Rate**
```python
match_rate = total_reused / total_steps * 100
```

### 2. **Find Steps That Need New BDD**
```python
new_bdd_steps = [r for r in results if r['final_action'] == 'NEW_BDD_REQUIRED']
```

### 3. **Analyze Reranker Usage**
```python
reranker_used = [r for r in results if r['reranker_score'] is not None]
reranker_skipped = [r for r in results if r['reranker_score'] is None]
```

### 4. **Group Matches by Scenario**
```python
# Find all candidates from same scenario
scenario_724_steps = [
    c for r in results 
    for c in r['top_k_candidates'] 
    if c['scenario_id'] == 724
]
```

### 5. **Analyze Score Distribution**
```python
vector_scores = [r['vector_similarity'] for r in results if r['vector_similarity']]
reranker_scores = [r['reranker_score'] for r in results if r['reranker_score'] is not None]
```

### 6. **Find Borderline Cases**
```python
# Steps with scores just above/below threshold
borderline = [
    r for r in results 
    if r['vector_similarity'] and 0.60 <= r['vector_similarity'] <= 0.70
]
```

### 7. **Performance Analysis**
```python
avg_time = sum(r['processing_time_ms'] for r in results) / len(results)
slow_queries = [r for r in results if r['processing_time_ms'] > 100]
```

### 8. **Identify Most Reused BDD Steps**
```python
from collections import Counter
most_reused = Counter(r['selected_candidate_id'] for r in results if r['selected_candidate_id'])
```

### 9. **Analyze Skip Reasons**
```python
from collections import Counter
skip_reasons = Counter(r['notes'] for r in results if r['notes'])
```

### 10. **1-to-Many Relationship Analysis**
```python
# Find steps with multiple matches from same scenario
for result in results:
    scenario_ids = [c['scenario_id'] for c in result['top_k_candidates']]
    if len(set(scenario_ids)) < len(scenario_ids):
        # Multiple matches from same scenario
        print(f"{result['query_id']}: {len(result['top_k_candidates'])} matches")
```

---

## üìä Example: Complete Result Structure

```json
{
  "total_testcases": 97,
  "total_steps": 1130,
  "total_reused": 1101,
  "total_new_required": 29,
  "testcases": [
    {
      "testcase_id": "C60092679",
      "total_steps": 28,
      "reused_count": 28,
      "new_required_count": 0,
      "results": [
        {
          "query_id": "C60092679_chunk_0",
          "parent_testcase_id": "C60092679",
          "chunk_index": 0,
          "original_chunk": "1. Scan the prepared Lotto bet...",
          "full_testcase_text": "1. Scan...\n2. Confirm...",
          "normalized_text": "scan the prepared lotto bet and ENTER the stake of <amount>...",
          "top_k_candidates": [
            {
              "individual_step_id": 13279,
              "step_type": "Then",
              "step_text": "I set stake '200' for the bet",
              "step_index": 3,
              "scenario_id": 724,
              "scenario_name": "OTC- Ante Post Option",
              "scenario_full_text": "Scenario: OTC- Ante Post Option\n...",
              "scenario_given_steps": "Given I am logged into...",
              "scenario_when_steps": null,
              "scenario_then_steps": "Then I set stake...",
              "reranker_score": null,
              "vector_similarity": 0.711
            }
            // ... 4 more candidates
          ],
          "selected_candidate_id": 13279,
          "selected_template": "Then: I set stake '200' for the bet",
          "final_action": "REUSED_TEMPLATE",
          "reranker_score": null,
          "vector_similarity": 0.711,
          "processing_time_ms": 56.64,
          "notes": "All top 5 above 90th percentile (0.711)"
        }
        // ... more results
      ]
    }
    // ... more test cases
  ]
}
```

---

## üîë Key Takeaways

1. **Hierarchical Structure**: Top-level ‚Üí Test cases ‚Üí Steps ‚Üí Candidates
2. **1-to-Many Support**: Each step can have up to 5 matches (`top_k_candidates`)
3. **Scenario Context**: Each candidate includes full scenario information
4. **Score Information**: Both vector and reranker scores available
5. **Processing Metadata**: Time, notes, and decisions tracked
6. **Flexible Analysis**: Rich data for various analysis needs

---

This structure provides comprehensive information for:
- ‚úÖ Performance analysis
- ‚úÖ Quality assessment
- ‚úÖ Debugging and optimization
- ‚úÖ Coverage analysis
- ‚úÖ Scenario grouping
- ‚úÖ Score distribution analysis
- ‚úÖ Reranker usage analysis
- ‚úÖ 1-to-many relationship understanding

